!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).SwupJsPlugin=e()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},t.apply(this,arguments)}const e=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class n{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,n])=>{if(!function(t,n,r){const i=function(t,e){var n;if("swup"===t)return null!=(n=e.version)?n:"";{var r;const n=e.findPlugin(t);return null!=(r=null==n?void 0:n.version)?r:""}}(t,r);return!!i&&((t,n)=>n.every(n=>{const[,r,i]=n.match(/^([\D]+)?(.*)$/)||[];var o,a;return((t,e)=>{const n={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(n[e]||n[""])(t)})((a=i,o=e(o=t),a=e(a),o.localeCompare(a,void 0,{numeric:!0})),r||">=")}))(i,n)}(t,n=Array.isArray(n)?n:[n],this.swup)){const e=`${t} ${n.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${e}`)}}),!0}on(t,e,n={}){var r;e=!(r=e).name.startsWith("bound ")||r.hasOwnProperty("prototype")?e.bind(this):e;const i=this.swup.hooks.on(t,e,n);return this.handlersToUnregister.push(i),i}once(e,n,r={}){return this.on(e,n,t({},r,{once:!0}))}before(e,n,r={}){return this.on(e,n,t({},r,{before:!0}))}replace(e,n,r={}){return this.on(e,n,t({},r,{replace:!0}))}off(t,e){return this.swup.hooks.off(t,e)}}function r(t,e){var n=[];return function(t,e,n){void 0===n&&(n={});var r=n.decode,i=void 0===r?function(t){return t}:r;return function(n){var r=t.exec(n);if(!r)return!1;for(var o=r[0],a=r.index,s=Object.create(null),c=function(t){if(void 0===r[t])return"continue";var n=e[t-1];s[n.name]="*"===n.modifier||"+"===n.modifier?r[t].split(n.prefix+n.suffix).map(function(t){return i(t,n)}):i(r[t],n)},u=1;u<r.length;u++)c(u);return{path:o,index:a,params:s}}}(a(t,n,e),n,e)}function i(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function o(t){return t&&t.sensitive?"":"i"}function a(t,e,n){return t instanceof RegExp?function(t,e){if(!e)return t;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(t.source);i;)e.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(t.source);return t}(t,e):Array.isArray(t)?function(t,e,n){var r=t.map(function(t){return a(t,e,n).source});return new RegExp("(?:".concat(r.join("|"),")"),o(n))}(t,e,n):function(t,e,n){return function(t,e,n){void 0===n&&(n={});for(var r=n.strict,a=void 0!==r&&r,s=n.start,c=void 0===s||s,u=n.end,f=void 0===u||u,p=n.encode,h=void 0===p?function(t){return t}:p,l=n.delimiter,m=void 0===l?"/#?":l,d=n.endsWith,v="[".concat(i(void 0===d?"":d),"]|$"),g="[".concat(i(m),"]"),w=c?"^":"",y=0,A=t;y<A.length;y++){var E=A[y];if("string"==typeof E)w+=i(h(E));else{var x=i(h(E.prefix)),P=i(h(E.suffix));if(E.pattern)if(e&&e.push(E),x||P)if("+"===E.modifier||"*"===E.modifier){var O="*"===E.modifier?"?":"";w+="(?:".concat(x,"((?:").concat(E.pattern,")(?:").concat(P).concat(x,"(?:").concat(E.pattern,"))*)").concat(P,")").concat(O)}else w+="(?:".concat(x,"(").concat(E.pattern,")").concat(P,")").concat(E.modifier);else w+="+"===E.modifier||"*"===E.modifier?"((?:".concat(E.pattern,")").concat(E.modifier,")"):"(".concat(E.pattern,")").concat(E.modifier);else w+="(?:".concat(x).concat(P,")").concat(E.modifier)}}if(f)a||(w+="".concat(g,"?")),w+=n.endsWith?"(?=".concat(v,")"):"$";else{var T=t[t.length-1],b="string"==typeof T?g.indexOf(T[T.length-1])>-1:void 0===T;a||(w+="(?:".concat(g,"(?=").concat(v,"))?")),b||(w+="(?=".concat(g,"|").concat(v,")"))}return new RegExp(w,o(n))}(function(t,e){void 0===e&&(e={});for(var n=function(t){for(var e=[],n=0;n<t.length;){var r=t[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)e.push({type:"CHAR",index:n,value:t[n++]});else{var i=1,o="";if("?"===t[s=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<t.length;)if("\\"!==t[s]){if(")"===t[s]){if(0==--i){s++;break}}else if("("===t[s]&&(i++,"?"!==t[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));o+=t[s++]}else o+=t[s++]+t[s++];if(i)throw new TypeError("Unbalanced pattern at ".concat(n));if(!o)throw new TypeError("Missing pattern at ".concat(n));e.push({type:"PATTERN",index:n,value:o}),n=s}else{for(var a="",s=n+1;s<t.length;){var c=t.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=t[s++]}if(!a)throw new TypeError("Missing parameter name at ".concat(n));e.push({type:"NAME",index:n,value:a}),n=s}else e.push({type:"CLOSE",index:n,value:t[n++]});else e.push({type:"OPEN",index:n,value:t[n++]});else e.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});else e.push({type:"MODIFIER",index:n,value:t[n++]})}return e.push({type:"END",index:n,value:""}),e}(t),r=e.prefixes,o=void 0===r?"./":r,a="[^".concat(i(e.delimiter||"/#?"),"]+?"),s=[],c=0,u=0,f="",p=function(t){if(u<n.length&&n[u].type===t)return n[u++].value},h=function(t){var e=p(t);if(void 0!==e)return e;var r=n[u],i=r.index;throw new TypeError("Unexpected ".concat(r.type," at ").concat(i,", expected ").concat(t))},l=function(){for(var t,e="";t=p("CHAR")||p("ESCAPED_CHAR");)e+=t;return e};u<n.length;){var m=p("CHAR"),d=p("NAME"),v=p("PATTERN");if(d||v)-1===o.indexOf(w=m||"")&&(f+=w,w=""),f&&(s.push(f),f=""),s.push({name:d||c++,prefix:w,suffix:"",pattern:v||a,modifier:p("MODIFIER")||""});else{var g=m||p("ESCAPED_CHAR");if(g)f+=g;else if(f&&(s.push(f),f=""),p("OPEN")){var w=l(),y=p("NAME")||"",A=p("PATTERN")||"",E=l();h("CLOSE"),s.push({name:y||(A?c++:""),pattern:y&&!A?a:A,prefix:w,suffix:E,modifier:p("MODIFIER")||""})}else h("END")}}return s}(t,n),e,n)}(t,e,n)}const s=(t,e)=>{try{return r(t,e)}catch(e){throw new Error(`[swup] Error parsing path "${t}":\n${e}`)}};return class extends n{constructor(t){super();const e=this,n=this;this.name="SwupJsPlugin",this.requires={swup:">=4"},this.defaults={animations:[{from:"(.*)",to:"(.*)",out:t=>t(),in:t=>t()}],matchOptions:{}},this.options=void 0,this.animations=[],this.awaitInAnimation=function(t,e){let{skip:r}=e;try{if(r)return Promise.resolve();const e=n.getBestAnimationMatch(t);return Promise.resolve(n.createAnimationPromise(e,t,"in")).then(function(){})}catch(t){return Promise.reject(t)}},this.awaitOutAnimation=function(t,n){let{skip:r}=n;try{if(r)return Promise.resolve();const n=e.getBestAnimationMatch(t);return Promise.resolve(e.createAnimationPromise(n,t,"out")).then(function(){})}catch(t){return Promise.reject(t)}},Array.isArray(t)&&(t={animations:t}),this.options={...this.defaults,...t},this.animations=this.compileAnimations()}mount(){this.replace("animation:in:await",this.awaitInAnimation,{priority:-1}),this.replace("animation:out:await",this.awaitOutAnimation,{priority:-1})}compileAnimations(){return this.options.animations.map(t=>{const e=s(t.from,this.options.matchOptions),n=s(t.to,this.options.matchOptions);return{...t,matchesFrom:e,matchesTo:n}})}createAnimationPromise(t,e,n){const r=t?t[n]:null;if(!t||!r)return console.warn("No animation found"),Promise.resolve();const i=t.matchesFrom(e.from.url),o=t.matchesTo(e.to.url),a={visit:e,direction:n,from:{url:e.from.url,pattern:t.from,params:i?i.params:{}},to:{url:e.to.url,pattern:t.to,params:o?o.params:{}}};return new Promise(t=>{const e=r(()=>t(),a);var n;!(n=e)||"object"!=typeof n&&"function"!=typeof n||"function"!=typeof n.then||e.then(t)})}getBestAnimationMatch(t){let e=0;return this.animations.reduceRight((n,r)=>{const i=this.rateAnimation(t,r);return i>=e?(e=i,r):n},null)}rateAnimation(t,e){const n=t.to.url,r=t.animation.name;let i=0;const o=e.matchesFrom(t.from.url);return o&&(i+=1),e.matchesTo(n)&&(i+=1),o&&e.to===r&&(i+=2),i}}});
//# sourceMappingURL=index.umd.js.map
